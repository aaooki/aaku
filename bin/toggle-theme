#!/bin/sh

# usage: source toggle-theme (toggle $theme|keep)
#

THEME_CONFIG_PATH=~/.config/system-theme

read_system_theme() {
  local current=$(cat $THEME_CONFIG_PATH 2>/dev/null)
  echo $current
}

toggle() {
  if [[ $1 == "dark" ]]; then
    echo "light"
  elif [[ $1 == "light" ]]; then
    echo "dark"
  else
    echo "dark"
  fi
}

keep() {
  echo $1
}

toggle_alacritty() {
  local config_path="$AAKU/alacritty/colors.yml"
  local alacritty_file="$AAKU/alacritty/alacritty.yml"
  sed -i -e "s#^colors: \*.*#colors: *$theme#g" $config_path
  touch $alacritty_file
}

toggle_nvims() {
  # https://github.com/chmln/nvim-ctrl
  #
  nvim-ctrl "call v:lua.ToggleTheme('$theme')"
}

toggle_gtk() {
  gsettings set org.gnome.desktop.interface gtk-theme "Colloid-$theme"
}

case "$1" in
  toggle)
    theme=$(toggle ${2:-$(read_system_theme)})
    ;;
  keep)
    theme=$(keep $(read_system_theme))
    ;;
  *)
    echo "Usage: $0 {toggle $theme|keep}"
    exit 2
esac

export TERM_COLOR_MODE="$theme"

toggle_alacritty
toggle_nvims
toggle_gtk

# update theme config
echo $theme > $THEME_CONFIG_PATH

exit 0
