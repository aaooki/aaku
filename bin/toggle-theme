#!/usr/bin/env zsh

# usage: source toggle-theme light
#

THEME_CONFIG_PATH=~/.config/system-theme

read_system_theme() {
  local current=$(cat $THEME_CONFIG_PATH 2>/dev/null)

  if [[ $current == "dark" ]]; then
    echo "light"
  elif [[ $current == "light" ]]; then
    echo "dark"
  else
    echo "dark"
  fi
}

local from_system_theme=$(read_system_theme)
local theme="${1:-$from_system_theme}"

toggle_alacritty() {
  local config_path="$AAKU/alacritty/colors.yml"
  local alacritty_file="$AAKU/alacritty/alacritty.yml"
  sed -i -e "s#^colors: \*.*#colors: *$theme#g" $config_path
  touch $alacritty_file
}

toggle_nvims() {
  # https://github.com/chmln/nvim-ctrl
  #
  nvim-ctrl "call v:lua.ToggleTheme('$theme')"
}

toggle_gtk() {
  gsettings set org.gnome.desktop.interface gtk-theme "Colloid-$theme"
}

export TERM_COLOR_MODE="$theme"

toggle_alacritty
toggle_nvims
toggle_gtk

# update theme config
echo $theme > $THEME_CONFIG_PATH
