set nocompatible              "no compatibility with legacy vi

"Plugins
call plug#begin('~/.vim/plugins')
Plug 'rking/ag.vim'
Plug 'ctrlpvim/ctrlp.vim'
Plug 'jeffkreeftmeijer/vim-numbertoggle'
Plug 'tpope/vim-fugitive'
Plug 'airblade/vim-gitgutter'
Plug 'tomtom/tcomment_vim'
Plug 'tpope/vim-surround'
Plug 'christoomey/vim-system-copy'
Plug 'junegunn/goyo.vim'
Plug 'NLKNguyen/papercolor-theme'
Plug 'tpope/vim-rails'
Plug 'fatih/vim-go'
Plug 'kchmck/vim-coffee-script'
Plug 'leafgarland/typescript-vim'
Plug 'mattn/emmet-vim'
call plug#end()

set lazyredraw
set autoread                    "automatically read changes in the file
set showcmd                     "display incomplete commands
set wildmenu
set laststatus=2                "always display the status bar
set hidden                      "hide buffers instead of closing them
set nowrap                      "disable soft wrap for lines
set scrolloff=2
set ruler
set number
set cursorline                  "higlight current line
set colorcolumn=81
set path+=**

set mouse=n
set ttymouse=xterm2

set t_Co=256                    "enable 256 colors
set background=dark
colorscheme PaperColor

set statusline=%=%m\ %P\ %f\    "modifiedflag, filepath, filepercent
hi StatusLine ctermfg=235 ctermbg=245 guifg=Grey15 guibg=Grey54
hi StatusLineNC ctermfg=235 ctermbg=237 guifg=Grey15 guibg=Grey23

set encoding=utf-8
set ttimeout
set ttimeoutlen=50
set history=77
set undolevels=77
set nobackup
set noswapfile

set incsearch
set ignorecase                  "searches are case insensitive...
set smartcase                   " ..unless they contain at least one capital letter

set autoindent                  "always set autoindenting on
set backspace=indent,eol,start  "backspace through everything in insert mode
set tabstop=2
set expandtab                   "use spaces, not tabs
set shiftwidth=2
set softtabstop=2
autocmd FileType c setlocal ts=4 sts=4 sw=4 noexpandtab
autocmd FileType make setlocal ts=8 sts=8 sw=8 noexpandtab

"Ag
let g:ag_working_path_mode="r"  "search from the project root instead of cwd

"CtrlP
if executable('ag')
  " Use Ag over Grep
  set grepprg=ag\ --nogroup\ --nocolor
  let g:ctrlp_user_command = 'ag %s -l --nocolor --hidden -g ""'
  let g:ctrlp_use_caching = 0 " no caching
endif

"The Leader
let mapleader = "\<Space>"

"map Silver Searcher
map \ :Ag!<space>

"bind K to search the word under cursor
nnoremap K :Ag! "\b<C-R><C-W>\b"<CR>:cw<CR>

"Ctags
set tags+=.git/tags
map <leader>ct :!ctags --tag-relative --extra=+f -Rf .git/tags --exclude=.git,pkg --languages=-javascript,sql<CR><CR>

"search tags
map <leader>t :CtrlPTag<cr>
"search files
nmap <leader>p :CtrlP<cr>
"search open buffers
nmap <leader>r :CtrlPBuffer<cr>

"cycle between last two open files
nnoremap <leader><leader> <c-^>

"new empty buffer
nmap <leader>T :enew<cr>
"next buffer
nmap <Tab> :bnext<CR>
"previous buffer
nmap <S-Tab> :bprevious<CR>
"close current buffer and move to the previous one
nmap <leader>bq :bp <BAR> bd #<CR>

"override file systems by typing :w!!
cmap w!! %!sudo tee > /dev/null %

"remove current line highlight in unfocused window
au VimEnter,WinEnter,BufWinEnter,FocusGained,CmdwinEnter *  set cul
au WinLeave,FocusLost,CmdwinLeave * set nocul

"window navigation and splits
set splitbelow
set splitright

map <silent> <C-h> :call WinMove('h')<cr>
map <silent> <C-j> :call WinMove('j')<cr>
map <silent> <C-k> :call WinMove('k')<cr>
map <silent> <C-l> :call WinMove('l')<cr>

"move to the window in the direction shown, or create a new window
function! WinMove(key)
  let t:curwin = winnr()
  exec "wincmd ".a:key
  if (t:curwin == winnr())
    if (match(a:key,'[jk]'))
      wincmd v
    else
      wincmd s
    endif
    exec "wincmd ".a:key
  endif
endfunction
