#!/usr/bin/env zsh

unalias rm
BASEDIR="$(cd "$(dirname "${ZSH_SOURCE[0]}")" && pwd)"

link_config() {
  src=$1
  dst=$2

  rm -rf $HOME/$dst
  ln -sfn ${BASEDIR}/$src $HOME/$dst
}

link_dev() {
  echo "Installing Dev config..."

  link_config vim/vim    .vim
  link_config vim/vimrc  .vimrc
  link_config vim/gvimrc .gvimrc

  link_config nvim .config/nvim

  link_config zsh/zsh      .zsh
  link_config zsh/zprofile .zprofile
  link_config zsh/zshenv   .zshenv
  link_config zsh/zshrc    .zshrc

  link_config git/gitconfig         .gitconfig
  link_config git/gitconfig.secrets .gitconfig.secrets
  link_config git/gitignore         .gitignore
  link_config git/gitattributes     .gitattributes

  link_config tmux/tmux.conf .tmux.conf
  link_config ruby/irbrc     .irbrc
  link_config scheme/csirc   .csirc
  link_config rg/rgignore    .rgignore
  link_config ctags/ctags    .ctags

  link_config alacritty .config/alacritty

  echo "fetching vim plugins..."
  vim -c PlugInstall -c qall

  echo "fetching nvim plugins..."
  nvim -c PackerSync -c qall

  source $HOME/.zshrc
  echo "zshrc sourced."
}

link_linux() {
  echo "Installing Linux config..."

  link_config bin/fehbg      .fehbg
  link_config X11/xinitrc    .xinitrc
  link_config X11/Xresources .Xresources
  link_config rofi           .config/rofi
  link_config dunst          .config/dunst
  link_config picom          .config/picom
  link_config fontconfig     .config/fontconfig
  link_config zathura        .config/zathura
}

link_macos() {
  echo "Installing MacOS config..."
}

link_cli_tools() {
  echo "Installing CLI tools..."

  link_config nnn      .config/nnn
  link_config newsboat .newsboat
  link_config cmus     .config/cmus
  link_config irssi    .irssi
}

link_fonts() {
  echo "Installing Fonts..."

  [ -d $HOME/Workspace/fonts/ ] && exit
  git clone https://github.com/powerline/fonts.git $HOME/Workspace/fonts/
  pushd $HOME/Workspace/fonts && ./install.sh && popd

  git clone https://github.com/sebastiencs/icons-in-terminal.git $HOME/Workspace/fonts/icons-in-terminal
  pushd $HOME/Workspace/fonts/icons-in-terminal && ./install.sh && popd
}

echo "Creating Workspace folder..."
mkdir -p $HOME/Workspace

echo "Updating Git submodules..."
git submodule update --init --recursive --remote

if [ $# -eq 0 ]; then
  echo "Installing all..."
  link_dev
  link_linux
  link_macos
  link_cli_tools
  link_fonts
elif [[ condition ]]; then
  while test $# -gt 0
  do
    case "$1" in
      dev)
        link_dev
        ;;
      linux)
        link_linux
        ;;
      macos)
        link_macos
        ;;
      cli)
        link_cli_tools
        ;;
      fonts)
        link_fonts
        ;;
      *)
        echo "Usage: $0 [*|dev|linux|macos|cli|fonts]"
        ;;
    esac
    shift
  done
fi
